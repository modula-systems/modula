<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Orthogonal manifold" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://modula.systems/algorithms/manifold/orthogonal/" />
<meta property="og:site_name" content="Modula" />
<meta property="og:description" content="On this page, we will work out an algorithm for performing gradient descent on the manifold of orthogonal matrices while taking steps that are steepest under the spectral norm. The algorithm will s..." />
<meta property="og:image" content="https://docs.modula.systems/_static/logo-square.jpeg" />
<meta property="og:image:alt" content="Modula" />
<meta name="description" content="On this page, we will work out an algorithm for performing gradient descent on the manifold of orthogonal matrices while taking steps that are steepest under the spectral norm. The algorithm will s..." />
<link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" /><link rel="next" title="Hello, MNIST!" href="../../../examples/hello-mnist/" /><link rel="prev" title="Hypersphere" href="../hypersphere/" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 7.0.0 and Furo 2024.08.06 -->
        <title>Orthogonal manifold - docs.modula.systems</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=04c057b233f3c8d71940eee6080f658a04e2027d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=cf727022eb7470bc603c08d2e55c3247faec75c9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../"><div class="brand">docs.modula.systems</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo-light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo-dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/reading-list/">Reading list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Algorithms:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Manifold duality maps</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Manifold duality maps</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../hypersphere/">Hypersphere</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Orthogonal manifold</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/hello-mnist/">Hello, MNIST!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More on Modula:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/">Modula FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/modula-systems/modula">Modula codebase</a></li>
<li class="toctree-l1"><a class="reference external" href="https://modula.systems/">Modula homepage</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/modula-systems/modula/blob/main/docs/source/algorithms/manifold/orthogonal.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/modula-systems/modula/edit/main/docs/source/algorithms/manifold/orthogonal.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="orthogonal-manifold">
<h1>Orthogonal manifold<a class="headerlink" href="#orthogonal-manifold" title="Permalink to this heading">¶</a></h1>
<p>On this page, we will work out an algorithm for performing gradient descent on the manifold of orthogonal matrices while taking steps that are steepest under the spectral norm. The algorithm will solve for the matrix of unit spectral norm that maximizes the linearized improvement in loss while lying tangent to the manifold. The “retraction map”—which sends the update from the tangent space back to the manifold—can oftentimes be performed by a simple scalar multiplication.</p>
<section id="steepest-descent-on-the-orthogonal-manifold">
<h2>Steepest descent on the orthogonal manifold<a class="headerlink" href="#steepest-descent-on-the-orthogonal-manifold" title="Permalink to this heading">¶</a></h2>
<p>Consider a square weight matrix <span class="math notranslate nohighlight">\(W\in\mathbb{R}^{n \times n}\)</span> that is orthogonal, meaning that <span class="math notranslate nohighlight">\(W^\top W = I_n\)</span>. Suppose that the “gradient matrix” <span class="math notranslate nohighlight">\(G\in\mathbb{R}^{n\times n}\)</span> is the derivative of some loss function evaluated at <span class="math notranslate nohighlight">\(W\)</span>. Given step size <span class="math notranslate nohighlight">\(\eta &gt; 0\)</span>, we claim that the following weight update is steepest under the spectral norm while staying on the orthogonal manifold. First, we compute the matrix <span class="math notranslate nohighlight">\(X = [W^\top G - G^\top W]^\sharp\)</span>, and then we make the update:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}W \mapsto \begin{cases}\frac{W (I_n - \eta X)}{\sqrt{1+\eta^2}} &amp;\text{if $W^\top G - G^\top W$ is full-rank;}\\
[W (I_n - \eta X)]^\sharp &amp;\text{otherwise.}\end{cases}\end{split}\]</div>
</div>
<p>In these expressions, <span class="math notranslate nohighlight">\(M^\sharp\)</span> denotes the <em>sharp-operator</em> applied to matrix <span class="math notranslate nohighlight">\(M\)</span>, which returns the matrix with the same singular vectors as <span class="math notranslate nohighlight">\(M\)</span> but all positive singular values are set to one. The sharp-operator can be computed by running a “Newton-Schulz” iteration, such as the following cubic iteration:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[M_0 = \frac{M}{\|M\|_F}; \qquad M_{t+1}=\frac{3}{2}M_t-\frac{1}{2}M_tM_t^\top M_t; \qquad t\to\infty,\]</div>
</div>
<p>which goes back to <a class="reference external" href="https://epubs.siam.org/doi/10.1137/0707031">Kovarik (1970)</a> and <a class="reference external" href="https://epubs.siam.org/doi/10.1137/0708036">Björck &amp; Bowie (1971)</a>.</p>
</section>
<section id="non-riemannian-manifold-methods">
<h2>Non-Riemannian manifold methods<a class="headerlink" href="#non-riemannian-manifold-methods" title="Permalink to this heading">¶</a></h2>
<p>One reason this algorithm is interesting is that it is an example of a manifold optimization algorithm that is <em>non-Riemannian</em>. A Riemmanian manifold is a manifold equipped with a structure called a <em>Riemannian metric</em>, which is an inner product defined at each point on the manifold. The inner product provides a way to measure distance and construct geometry-aware optimization algorithms. There has been a lot of research into Riemannian optimization methods. Some examples in a machine learning context are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/2102.07432">Fast and accurate optimization on the orthogonal manifold without retraction</a>;</p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/2002.01113">Efficient Riemannian optimization on the Stiefel manifold via the Cayley transform</a>.</p></li>
</ul>
<p>However, there has seemingly been much less research into optimization algorithms on manifolds equipped with non-Riemannian structures. For instance, a matrix manifold equipped with the spectral norm at every point is non-Riemannian since the spectral norm does not emerge from an inner product. But we believe these kinds of non-Riemannian geometries are very important in deep learning.</p>
</section>
<section id="the-structure-of-the-tangent-space">
<h2>The structure of the tangent space<a class="headerlink" href="#the-structure-of-the-tangent-space" title="Permalink to this heading">¶</a></h2>
<p>We would like to make a weight update so that the updated weights stay on the orthogonal manifold. First we need to figure out the structure of the “tangent space” at a point on the manifold. Roughly speaking, the tangent space is the set of possible velocities a particle could have as it passes through that particular point. So we need to consider all curves passing through the point on the manifold.</p>
<p>If we consider a curve <span class="math notranslate nohighlight">\(W(t)\)</span> on the manifold parameterized by time <span class="math notranslate nohighlight">\(t \in \mathbb{R}\)</span>, then this curve must satisfy <span class="math notranslate nohighlight">\(W(t)^\top W(t) = I_n\)</span>. Differentiating with respect to <span class="math notranslate nohighlight">\(t\)</span>, we find that the velocity must satisfy:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{\partial W(t)}{\partial t}^\top W(t) + W(t)^\top \frac{\partial W(t)}{\partial t} = 0.\]</div>
</div>
<p>So to be in the tangent space of a point <span class="math notranslate nohighlight">\(W\)</span> on the manifold, a matrix <span class="math notranslate nohighlight">\(A\)</span> must satisfy <span class="math notranslate nohighlight">\(A^\top W + W^\top A = 0\)</span>. Conversely, if a matrix <span class="math notranslate nohighlight">\(A\)</span> satisfies <span class="math notranslate nohighlight">\(A^\top W + W^\top A=0\)</span>, then it is the velocity of a curve on the manifold that passes through <span class="math notranslate nohighlight">\(W\)</span>, as evidenced by the curve <span class="math notranslate nohighlight">\(W(t) = W \exp(tW^\top A)\)</span>. Therefore, the tangent space at <span class="math notranslate nohighlight">\(W\)</span> is completely characterized by the set:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\{A\in \mathbb{R}^{n\times n}:A^\top W + W^\top A = 0\}.\]</div>
</div>
<p>Finally, if we use the orthogonal matrix <span class="math notranslate nohighlight">\(W\)</span> to make the change of variables <span class="math notranslate nohighlight">\(A = W X\)</span>, then we see that <span class="math notranslate nohighlight">\(A\)</span> belongs to the tangent space at <span class="math notranslate nohighlight">\(W\)</span> if and only if <span class="math notranslate nohighlight">\(X\)</span> is skew-symmetric: <span class="math notranslate nohighlight">\(X^\top + X = 0\)</span>. So the tangent space to the orthogonal manifold can be parameterized by skew-symmetric matrices.</p>
</section>
<section id="steepest-direction-in-the-tangent-space">
<h2>Steepest direction in the tangent space<a class="headerlink" href="#steepest-direction-in-the-tangent-space" title="Permalink to this heading">¶</a></h2>
<p>We will solve for the matrix <span class="math notranslate nohighlight">\(A\)</span> that belongs to the tangent space to the orthogonal manifold at matrix <span class="math notranslate nohighlight">\(W\)</span> and maximizes the linearized improvement in loss <span class="math notranslate nohighlight">\(\operatorname{trace}(G^\top A)\)</span> under the constraint that <span class="math notranslate nohighlight">\(A\)</span> has unit spectral norm. Formally, we wish to solve:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{arg max}_{A\in \mathbb{R}^{n\times n}: \|A\|_*\leq 1 \text{ and } A^\top W + W^\top A = 0}\; \operatorname{trace}(G^\top A).\]</div>
</div>
<p>To simplify, we make the change of variables <span class="math notranslate nohighlight">\(A = W X\)</span> so that we now only need to maximize over skew-symmetric matrices <span class="math notranslate nohighlight">\(X\)</span> of unit spectral norm:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{arg max}_{X\in \mathbb{R}^{n\times n}:\|X\|_*\leq 1 \text{ and } X^\top + X= 0}\; \operatorname{trace}([W^\top G]^\top X).\]</div>
</div>
<p>Next, we decompose <span class="math notranslate nohighlight">\(W^\top G = \frac{1}{2}[W^\top G + G^\top W] + \frac{1}{2}[W^\top G - G^\top W]\)</span> into its symmetric and skew-symmetric components and realize that, because <span class="math notranslate nohighlight">\(X\)</span> is skew-symmetric, the contribution to the trace from the symmetric part of <span class="math notranslate nohighlight">\(W^\top G\)</span> vanishes. So the problem becomes:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{arg max}_{X\in \mathbb{R}^{n\times n}:\|X\|_*\leq 1 \text{ and } X^\top + X= 0}\; \operatorname{trace}\left(\left[\frac{W^\top G - G^\top W}{2}\right]^\top X\right).\]</div>
</div>
<p>If we simply ignore the skew-symmetric constraint, the solution for <span class="math notranslate nohighlight">\(X\)</span> is given by <span class="math notranslate nohighlight">\(X = [W^\top G - G^\top W]^\sharp\)</span>. But this solution for <span class="math notranslate nohighlight">\(X\)</span> actually satisfies the skew-symmetric constraint! This is because the sharp-operator preserves skew-symmetry. An easy way to see this is that <span class="math notranslate nohighlight">\([W^\top G - G^\top W]^\sharp\)</span> can be computed by running an odd polynomial iteration (“Newton-Schulz”) on <span class="math notranslate nohighlight">\(W^\top G - G^\top W\)</span>, and odd polynomials preserve skew-symmetry. <a class="footnote-reference brackets" href="#youla" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<p>Undoing the change of variables, our tangent vector is given by <span class="math notranslate nohighlight">\(A = W X = W [W^\top G - G^\top W]^\sharp\)</span>.</p>
</section>
<section id="finding-the-retraction-map">
<h2>Finding the retraction map<a class="headerlink" href="#finding-the-retraction-map" title="Permalink to this heading">¶</a></h2>
<p>The previous section suggests making the weight update <span class="math notranslate nohighlight">\(W \mapsto W - \eta W X = W (I_n - \eta X)\)</span>. This update takes a step in the tangent space and will actually diverge slightly from the orthogonal manifold. We can fix this issue by using the sharp-operator, i.e. <span class="math notranslate nohighlight">\(W \mapsto [W (I_n - \eta X)]^\sharp\)</span> to project the weights back to the manifold. But there is actually a shortcut: if <span class="math notranslate nohighlight">\(W^\top G - G^\top W\)</span> is full rank, then <span class="math notranslate nohighlight">\(X\)</span> is an orthogonal matrix and <span class="math notranslate nohighlight">\([W (I_n - \eta X)]^\top [W (I_n - \eta X)] = (1 + \eta^2) I_n\)</span>. Therefore, in this case, we can project back to the manifold simply by dividing through by the scalar <span class="math notranslate nohighlight">\(\sqrt{1+\eta^2}\)</span>. It’s worth noting that if <span class="math notranslate nohighlight">\(n\)</span> is odd, then <span class="math notranslate nohighlight">\(W^\top G - G^\top W\)</span> must have at least one zero singular value so it cannot be full rank. This issue can be avoided simply by making <span class="math notranslate nohighlight">\(n\)</span> even!</p>
</section>
<section id="open-problem-extending-to-the-stiefel-manifold">
<h2>Open problem: Extending to the Stiefel Manifold<a class="headerlink" href="#open-problem-extending-to-the-stiefel-manifold" title="Permalink to this heading">¶</a></h2>
<p>I initially thought that this solution easily extended to the <em>Stiefel manifold</em>—i.e. the set of <span class="math notranslate nohighlight">\(m \times n\)</span> semi-orthogonal matrices. But this turns out not to be the case: the algorithm we derived is generally not optimal if <span class="math notranslate nohighlight">\(W\)</span> is rectangular. To see this, let’s consider an <span class="math notranslate nohighlight">\(m \times n\)</span> matrix <span class="math notranslate nohighlight">\(W\)</span> with <span class="math notranslate nohighlight">\(m &gt; n\)</span>, and suppose that it belongs to the Stiefel manifold <span class="math notranslate nohighlight">\(W^\top W = I_n\)</span>. The problem with our derivation is that the change of variables <span class="math notranslate nohighlight">\(A = W X\)</span> no longer parameterizes the full set of <span class="math notranslate nohighlight">\(m \times n\)</span> matrices. Instead, we need to make the change of variable <span class="math notranslate nohighlight">\(A = WX + \overline{W}Y\)</span> where the columns of <span class="math notranslate nohighlight">\(\overline{W}\)</span> are the “missing” columns of <span class="math notranslate nohighlight">\(W\)</span>. In other words, the combined matrix <span class="math notranslate nohighlight">\([W | \overline{W}]\)</span> is a square orthogonal matrix. For this parameterization, the tangent space to the Stiefel manifold is obtained by requiring that <span class="math notranslate nohighlight">\(X\in\mathbb{R}^{n\times n}\)</span> is skew-symmetric while <span class="math notranslate nohighlight">\(Y\in\mathbb{R}^{(m-n)\times n}\)</span> is completely unconstrained. I do not know how to analytically solve the resulting maximization problem in this parameterization.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="youla" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>In fact, any odd function applied entrywise to the singular values of a matrix will preserve skew symmetry. To see this, one needs to understand the spectral structure of skew-symmetric matrices. An <span class="math notranslate nohighlight">\(n\times n\)</span> matrix <span class="math notranslate nohighlight">\(X\)</span> is skew symmetric if and only if it can be written <span class="math notranslate nohighlight">\(X = \sum_{i=1}^k \sigma_i (u_iv_i^\top - v_i u_i^\top)\)</span>, where the <span class="math notranslate nohighlight">\(\sigma_i\)</span> are non-negative, the <span class="math notranslate nohighlight">\(\{u_i\}\cup\{v_i\}\)</span> are all orthonormal and <span class="math notranslate nohighlight">\(k \leq \lfloor n/2 \rfloor\)</span>. In other words, <span class="math notranslate nohighlight">\(X\)</span> must admit an SVD where the singular values come in pairs with conjugate singular vectors. But applying an odd function <span class="math notranslate nohighlight">\(f\)</span> to the singular values yields <span class="math notranslate nohighlight">\(\sum_{i=1}^k f(\sigma_i) (u_iv_i^\top - v_i u_i^\top)\)</span>, which leaves the skew-symmetric structure intact. For more reading on the spectral structure of skew-symmetric matrices, see <a class="reference external" href="https://scipp.ucsc.edu/~haber/ph218/pfaffian15.pdf">(Haber, 2016)</a> or <a class="reference external" href="https://www.cambridge.org/core/journals/canadian-journal-of-mathematics/article/normal-form-for-a-matrix-under-the-unitary-congruence-group/964D0AA8DAC0CDB9079F04331B61859D">(Youla, 1961)</a>.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../../examples/hello-mnist/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Hello, MNIST!</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../hypersphere/">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Hypersphere</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Jeremy Bernstein
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/modula-systems/modula" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Orthogonal manifold</a><ul>
<li><a class="reference internal" href="#steepest-descent-on-the-orthogonal-manifold">Steepest descent on the orthogonal manifold</a></li>
<li><a class="reference internal" href="#non-riemannian-manifold-methods">Non-Riemannian manifold methods</a></li>
<li><a class="reference internal" href="#the-structure-of-the-tangent-space">The structure of the tangent space</a></li>
<li><a class="reference internal" href="#steepest-direction-in-the-tangent-space">Steepest direction in the tangent space</a></li>
<li><a class="reference internal" href="#finding-the-retraction-map">Finding the retraction map</a></li>
<li><a class="reference internal" href="#open-problem-extending-to-the-stiefel-manifold">Open problem: Extending to the Stiefel Manifold</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>